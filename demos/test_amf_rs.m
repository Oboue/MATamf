% Demo for an advanced median filter (AMF) for improving the signal-to-noise ratio of seismological datasets

% Script to plot Figures 4 and 5

%  Copyright (C) Oboue et al., 2022

%  This program is free software: you can redistribute it and/or modify
%  it under the terms of the GNU General Public License as published
%  by the Free Software Foundation, either version 3 of the License, or
%  any later version.

%  This program is distributed in the hope that it will be useful,
%  but WITHOUT ANY WARRANTY; without even the implied warranty of
%  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
%  GNU General Public License for more details: http://www.gnu.org/licenses/

%  References

%  Oboue et al., 2022
%  Huang, G., M. Bai, Q. Zhao, W. Chen, and Y. Chen, 2021, Erratic noise suppression using iterative structure-oriented space-varying median filtering with sparsity constraint, Geophysical Prospecting, 69, 101-121.
%  Chen, Y., S. Zu, Y. Wang, and X. Chen, 2020, Deblending of simultaneous-source data using a structure-oriented space varying median filter, Geophysical Journal International, 222, 1805�1�723.
%  Zhao, Q., Q. Du, X. Gong, and Y. Chen, 2018, Signal-preserving erratic noise attenuation via iterative robust sparsity-promoting filter, IEEE Transactions on Geoscience and Remote Sensing, 56, 1558-0644.
%-------------------------------------------------------------------------
clc;clear;close all;
%% addpath
addpath('../amf_data/');
addpath('../amfsrcs/');
addpath('../seistr/');

%% read field reflection seismic data 1
fid=fopen('real2.bin','r');
d2d=fread(fid,[256,256],'float');

dn=amf_scale(d2d,2);
[n1,n2]=size(dn);
din1=dn;
%%  Denosing using the BP method
% Parameter tuning for the BP method
%
dt=0.0005; % sampling
flo=0;     % Low frequency in band, default is 0
fhi=200;   % High frequency in band, default is Nyquist
nplo=6;    % number of poles for low cutoff
nphi=6;    % number of poles for high cutoff
phase=0;   % y: minimum phase, n: zero phase
verb0=0;   % verbosity flag
%
tic
d1_bp1=amf_bp(din1,dt,flo,fhi,nplo,nphi,phase,verb0);
toc
%
%% Denosing using the BP+SOSVMF method 
% Parameter tuning：add the key parameters of the SOSVMF method

niter=2;                      % number of nonlinear iterations
liter=10;                     % liter: number of linear iterations (in divn)
order1=3;                     % order: accuracy order
eps_dv=0.01;                  % eps_dv: eps for divn  (default: 0.01)
eps_cg=1;                     % eps_cg: eps for CG    (default: 1)
tol_cg=0.000001;              % tol_cg: tolerence for CG (default: 0.000001)
rect(1)=50;                   % rect:  smoothing radius (ndim*1)
rect(2)=50;                   % "      "        "
rect(3)=1;                    % "      "        "
verb1=1;                      % verbosity flag

adj=0;                        % adjoint flag
add=0;                        % adding flag
ns=8;                         % spray radius
order2=2;                     % PWD order
eps=0.01;                     % regularization (default:0.01);
ndn=n1*n2;                    % size of dn (n1*n2)
nds=n1*n2;                    % size of ds (n1*n2)
type_mf=1;                    % 0 (MF) or 1 (SVMF)
ifsmooth=0;                   % 1 (if smooth) or 0 (only MF)

%
tic
d1_bpsosvmf1=amf_bpsosvmf(din1,dt,flo,fhi,nplo,nphi,phase,verb0,niter,liter,order1,eps_dv,eps_cg,tol_cg,rect,verb1,adj,add,n1,n2,ns,order2,eps,ndn,nds,type_mf,ifsmooth);
toc
%

%% Denoising using the BP+SOSVMF+FK method 
%  Parameter tuning：add the key parameters of the dip filter in FK domain method
%
w=0.00;   % half width (in percentage) of the cone filter (i.e., w*nk=nwidth)
%
tic
d1_bpsosvmffk1=amf_bpsosvmffk(din1,dt,flo,fhi,nplo,nphi,phase,verb0,niter,liter,order1,eps_dv,eps_cg,tol_cg,rect,verb1,adj,add,n1,n2,ns,order2,eps,ndn,nds,type_mf,ifsmooth,w);
toc
%
%% Denoising data using the BP+SOSVMF+FK+curvelet method 
%  Parameter tuning：add the key parameters of the curvelet method
%
c1=1;                % Type of the transform(0: complex-valued curvelets,1: real-valued curvelets)
c2=1;                % Chooses one of two possibilities for the coefficients at the finest level(1: curvelets,2: wavelets)
c3=0.5;               % Thresholding parameter (alpha)
niter1=10;           % Number of iteration
% 
tic
d1_bpsosvmffkct1=amf_bpsosvmffkct(din1,dt,flo,fhi,nplo,nphi,phase,verb0,niter,liter,order1,eps_dv,eps_cg,tol_cg,rect,verb1,adj,add,n1,n2,ns,order2,eps,ndn,nds,type_mf,ifsmooth,w,c1,c2,c3,niter1);
toc
%
%% Denoising using the AMF method 
%  Parameter tuning: add the key parameters for the local orthogonalization operation

par.dt=0.0005; % sampling
par.flo=0;     % Low frequency in band, default is 0
par.fhi=200;   % High frequency in band, default is Nyquist
par.nplo=6;    % number of poles for low cutoff
par.nphi=6;    % number of poles for high cutoff
par.phase=0;   % y: minimum phase, n: zero phase
par.verb0=0;   % verbosity flag

par.niter=niter;                 % number of nonlinear iterations
par.liter=liter;                 % liter: number of linear iterations (in divn)
par.order1=order1;               % order: accuracy order
par.eps_dv=eps_dv;               % eps_dv: eps for divn  (default: 0.01)
par.eps_cg=eps_cg;               % eps_cg: eps for CG    (default: 1)
par.tol_cg=tol_cg;               % tol_cg: tolerence for CG (default: 0.000001)
par.rect(1)=rect(1);             % rect:  smoothing radius (ndim*1)
par.rect(2)=rect(2);             % "      "        "
par.rect(3)=rect(3);             % "      "        "
par.verb1=verb1;                 % verbosity flag

par.adj=adj;                     % adjoint flag
par.add=add;                     % adding flag
par.ns=ns;                       % spray radius
par.order2=order2;               % PWD order
par.eps=eps;                     % regularization (default:0.01);
par.ndn=ndn;                     % size of dn (n1*n2)
par.nds=nds;                     % size of ds (n1*n2)
par.type_mf=type_mf;             % 0 (MF) or 1 (SVMF)
par.ifsmooth=ifsmooth;                   % 1 (if smooth) or 0 (only MF)

par.w=w;                        % half width (in percentage) of the cone filter (i.e., w*nk=nwidth)

par.c1=c1;                      % Type of the transform(0: complex-valued curvelets,1: real-valued curvelets)
par.c2=c2;                      % Chooses one of two possibilities for the coefficients at the finest level(1: curvelets,2: wavelets)
par.c3=c3;                      % Thresholding parameter (alpha)
par.niter1=niter1;              % Number of iteration

%

rec = zeros(3, 1);    % 3-D vector denoting smooth radius 
par.rec(1) = 10;
par.rec(2) = 10;
par.rec(3) = 1;
par.eps1=0;               % regularization parameter, default 0.0
par.niter2=20;            % number of CG iterations
par.verb=1;               % verbosity flag (default: 0) 
%tic
d1_amf1=amf(din1,par);
toc
%%
% Plot figures

t=[0:n1]*0.004;
x=1:n2;
% ngap=10;
ngap0=3;
d1_11=[din1,ones(n1,ngap0),d1_bp1,ones(n1,ngap0),din1-d1_bp1,ones(n1,ngap0),d1_bpsosvmf1,ones(n1,ngap0),din1-d1_bpsosvmf1];
d1_21=[d1_bpsosvmffkct1,ones(n1,ngap0),d1_bpsosvmffkct1-din1,ones(n1,ngap0),d1_amf1,din1-d1_amf1];
%% local similarity maps

rect=[10,10,1];niter=20;eps=0;verb=0;
[simid11]=amf_localsimi(din1-d1_bp1,d1_bp1,rect,niter,eps,verb);
[simid12]=amf_localsimi(din1-d1_bpsosvmf1,d1_bpsosvmf1,rect,niter,eps,verb);
% [simid13]=amf_localsimi(din1-d1_bpsosvmffk,d1_bpsosvmffk,rect,niter,eps,verb);
[simid14]=amf_localsimi(din1-d1_bpsosvmffkct1,d1_bpsosvmffkct1,rect,niter,eps,verb);
[simid15]=amf_localsimi(din1-d1_amf1,d1_amf1,rect,niter,eps,verb);
d1_sim1=[simid11,ones(n1,ngap0),simid12,ones(n1,ngap0),simid14,ones(n1,ngap0),simid15];
%% read field reflection seismic data 2

fid=fopen('real.bin','r');
ori=fread(fid,[800,220],'float');

dn=amf_scale(ori,2);
[n1,n2]=size(dn)
din2=dn;
%%  Denosing using the BP method
% Parameter tuning for the BP method
%
dt=0.0005; % sampling
flo=0;     % Low frequency in band, default is 0
fhi=200;   % High frequency in band, default is Nyquist
nplo=6;    % number of poles for low cutoff
nphi=6;    % number of poles for high cutoff
phase=0;   % y: minimum phase, n: zero phase
verb0=0;   % verbosity flag
%
tic
d2_bp=amf_bp(din2,dt,flo,fhi,nplo,nphi,phase,verb0);
toc
%
%% Denosing using the BP+SOSVMF method 
% Parameter tuning：add the key parameters of the SOSVMF method

niter=2;                      % number of nonlinear iterations
liter=10;                     % liter: number of linear iterations (in divn)
order1=3;                     % order: accuracy order
eps_dv=0.01;                  % eps_dv: eps for divn  (default: 0.01)
eps_cg=1;                     % eps_cg: eps for CG    (default: 1)
tol_cg=0.000001;              % tol_cg: tolerence for CG (default: 0.000001)
rect(1)=50;                   % rect:  smoothing radius (ndim*1)
rect(2)=50;                   % "      "        "
rect(3)=1;                    % "      "        "
verb1=1;                      % verbosity flag

adj=0;                        % adjoint flag
add=0;                        % adding flag
ns=8;                         % spray radius
order2=2;                     % PWD order
eps=0.01;                     % regularization (default:0.01);
ndn=n1*n2;                    % size of dn (n1*n2)
nds=n1*n2;                    % size of ds (n1*n2)
type_mf=1;                    % 0 (MF) or 1 (SVMF)
ifsmooth=0;                   % 1 (if smooth) or 0 (only MF)
%                                                                                                             0,0,dipn,[],n1,n2,ns,2,0.01,n1*n2,n1*n2,type_mf,ifsmooth,d1,[]
tic
d2_bpsosvmf=amf_bpsosvmf(din2,dt,flo,fhi,nplo,nphi,phase,verb0,niter,liter,order1,eps_dv,eps_cg,tol_cg,rect,verb1,adj,add,n1,n2,ns,order2,eps,ndn,nds,type_mf,ifsmooth);
toc
% 
%% Denoising using the BP+SOSVMF+FK method 
%  Parameter tuning：add the key parameters of the dip filter in FK domain method
%
w=0.00;   % half width (in percentage) of the cone filter (i.e., w*nk=nwidth)
% 
tic
d2_bpsosvmffk=amf_bpsosvmffk(din2,dt,flo,fhi,nplo,nphi,phase,verb0,niter,liter,order1,eps_dv,eps_cg,tol_cg,rect,verb1,adj,add,n1,n2,ns,order2,eps,ndn,nds,type_mf,ifsmooth,w);
toc
%
%% Denoising data using the BP+SOSVMF+FK+curvelet method 
%  Parameter tuning：add the key parameters of the curvelet method
%
c1=1;                % Type of the transform(0: complex-valued curvelets,1: real-valued curvelets)
c2=1;                % Chooses one of two possibilities for the coefficients at the finest level(1: curvelets,2: wavelets)
c3=0.5;               % Thresholding parameter (alpha)
niter1=10;           % Number of iteration
% 
tic
d2_bpsosvmffkct=amf_bpsosvmffkct(din2,dt,flo,fhi,nplo,nphi,phase,verb0,niter,liter,order1,eps_dv,eps_cg,tol_cg,rect,verb1,adj,add,n1,n2,ns,order2,eps,ndn,nds,type_mf,ifsmooth,w,c1,c2,c3,niter1);
toc
%
%% Denoising using the AMF method 
%  Parameter tuning: add the key parameters for the local orthogonalization operation

par.dt=0.0005; % sampling
par.flo=0;     % Low frequency in band, default is 0
par.fhi=200;   % High frequency in band, default is Nyquist
par.nplo=6;    % number of poles for low cutoff
par.nphi=6;    % number of poles for high cutoff
par.phase=0;   % y: minimum phase, n: zero phase
par.verb0=0;   % verbosity flag

par.niter=niter;                 % number of nonlinear iterations
par.liter=liter;                 % liter: number of linear iterations (in divn)
par.order1=order1;               % order: accuracy order
par.eps_dv=eps_dv;               % eps_dv: eps for divn  (default: 0.01)
par.eps_cg=eps_cg;               % eps_cg: eps for CG    (default: 1)
par.tol_cg=tol_cg;               % tol_cg: tolerence for CG (default: 0.000001)
par.rect(1)=rect(1);             % rect:  smoothing radius (ndim*1)
par.rect(2)=rect(2);             % "      "        "
par.rect(3)=rect(3);             % "      "        "
par.verb1=verb1;                 % verbosity flag

par.adj=adj;                     % adjoint flag
par.add=add;                     % adding flag
par.ns=ns;                       % spray radius
par.order2=order2;               % PWD order
par.eps=eps;                     % regularization (default:0.01);
par.ndn=ndn;                     % size of dn (n1*n2)
par.nds=nds;                     % size of ds (n1*n2)
par.type_mf=type_mf;             % 0 (MF) or 1 (SVMF)
par.ifsmooth=ifsmooth;                   % 1 (if smooth) or 0 (only MF)

par.w=w;                        % half width (in percentage) of the cone filter (i.e., w*nk=nwidth)

par.c1=c1;                      % Type of the transform(0: complex-valued curvelets,1: real-valued curvelets)
par.c2=c2;                      % Chooses one of two possibilities for the coefficients at the finest level(1: curvelets,2: wavelets)
par.c3=c3;                      % Thresholding parameter (alpha)
par.niter1=niter1;              % Number of iteration
%
rec = zeros(3, 1);              % 3-D vector denoting smooth radius 
par.rec(1) = 10;
par.rec(2) = 10;
par.rec(3) = 1;
par.eps1=0;               % regularization parameter, default 0.0
par.niter2=20;            % number of CG iterations
par.verb=1;               % verbosity flag (default: 0) 
%tic
d2_amf=amf(din2,par);
toc 
%%
t=[0:n1]*0.002;
x=1:n2;
% ngap=5;
ngap0=3;
d2_1=[din2,ones(n1,ngap0),d2_bp,ones(n1,ngap0),ones(n1,ngap0),din2-d2_bp,ones(n1,ngap0),d2_bpsosvmf,ones(n1,ngap0),din2-d2_bpsosvmf];
d2_2=[d2_bpsosvmffkct,ones(n1,ngap0),din2-d2_bpsosvmffkct,ones(n1,ngap0),d2_amf,ones(n1,ngap0),din2-d2_amf];
%% local similarity maps
rect=[10,10,1];niter=20;eps=0;verb=0;
[simid21]=amf_localsimi(din2-d2_bp,d2_bp,rect,niter,eps,verb);
[simid22]=amf_localsimi(din2-d2_bpsosvmf,d2_bpsosvmf,rect,niter,eps,verb);
%[simid23]=amf_localsimi(din2-d2_bpsosvmffk,d2_bpsosvmffk,rect,niter,eps,verb);
[simid24]=amf_localsimi(din2-d2_bpsosvmffkct,d2_bpsosvmffkct,rect,niter,eps,verb);
[simid25]=amf_localsimi(din2-d2_amf,d2_amf,rect,niter,eps,verb);
d_sim2=[simid21,ones(n1,ngap0),simid22,ones(n1,ngap0),simid24,ones(n1,ngap0),simid25];
%% Plot figures/ first field data
figure('units','normalized','Position',[0.0 0.0 0.5, 1],'color','w');
ax(1)=subplot(5,1,1); imagesc(x,t,d1_11);colormap(ax(1),amf_seis);hold on
text(n1/-40,-0.18,'(a)','color','k','Fontsize',20,'fontweight','bold','HorizontalAlignment','center');
text(n2/9.5,-0.18,'Raw','color','k','Fontsize',16,'fontweight','bold','HorizontalAlignment','center');
text(n2/2.45,-0.18,'BP','color','k','Fontsize',16,'fontweight','bold','HorizontalAlignment','center');
text(n2/1.2,-0.18,'BP+SOSVMF','color','k','Fontsize',16,'fontweight','bold','HorizontalAlignment','center');
ylabel('Time (s)','Fontsize',16,'fontweight','bold');
xlabel('Panel','Fontsize',16,'fontweight','bold');
set(gca,'Linewidth',2,'Fontsize',12,'Fontweight','bold');
set(gca,'XTick',0)
colormap(amf_seis);caxis([-0.4,0.4]);
annotation(gcf,'textbox',...
    [0.188777777777778 0.800785083415112 0.0201111111111111 0.0196270853778193],...
    'String',{'1'},...
    'FontWeight','bold',...
    'FontSize',15,...
    'FitBoxToText','off',...
    'EdgeColor','none');
annotation(gcf,'textbox',...
    [0.343222222222222 0.80078508341511 0.0201111111111111 0.0196270853778193],...
    'String','2',...
    'FontWeight','bold',...
    'FontSize',15,...
    'FitBoxToText','off',...
    'EdgeColor','none');
annotation(gcf,'textbox',...
    [0.506555555555555 0.80078508341511 0.0201111111111111 0.0196270853778193],...
    'String','3',...
    'FontWeight','bold',...
    'FontSize',15,...
    'FitBoxToText','off',...
    'EdgeColor','none');
annotation(gcf,'textbox',...
    [0.666555555555556 0.800785083415109 0.0201111111111112 0.0196270853778193],...
    'String','4',...
    'FontWeight','bold',...
    'FontSize',15,...
    'FitBoxToText','off',...
    'EdgeColor','none');
annotation(gcf,'textbox',...
    [0.818777777777778 0.800785083415109 0.0201111111111113 0.0196270853778193],...
    'String','5',...
    'FontWeight','bold',...
    'FontSize',15,...
    'FitBoxToText','off',...
    'EdgeColor','none');
% annotation(gcf,'line',[0.286666666666667 0.285555555555555],...
%     [0.923454367026497 0.799803729146219],'LineWidth',2);
% annotation(gcf,'line',[0.44 0.438888888888889],...
%     [0.924435721295383 0.800785083415104],'LineWidth',2);
% annotation(gcf,'line',[0.593333333333333 0.592222222222222],...
%     [0.924435721295383 0.800785083415105],'LineWidth',2);
% annotation(gcf,'line',[0.75 0.748888888888889],...
%     [0.924435721295384 0.800785083415105],'LineWidth',2);
annotation(gcf,'rectangle',...
    [0.12965811965812 0.888226622502092 0.774684210526315 0.0160906422577708],...
    'LineWidth',3);
annotation(gcf,'textarrow',[0.237777777777778 0.208072916666666],...
    [0.862034239677744 0.846381461183997],'Color',[1 0 0],'TextColor',[1 0 0],...
    'LineWidth',3,...
    'HeadWidth',25,...
    'HeadLength',15,...
    'FontWeight','bold');
annotation(gcf,'textarrow',[0.385555555555555 0.414739583333333],...
    [0.857767062203312 0.831315153657818],'Color',[1 0 0],'TextColor',[1 0 0],...
    'LineWidth',3,...
    'HeadWidth',25,...
    'HeadLength',15,...
    'FontWeight','bold');

ax(2)=subplot(5,1,2); imagesc(x,t,d1_21);colormap(ax(2),amf_seis);hold on
text(n1/-40,-0.18,'(b)','color','k','Fontsize',20,'fontweight','bold','HorizontalAlignment','center');
text(n2/3.50,-0.18,'BP+SOSVMF+Curvelet','color','k','Fontsize',16,'fontweight','bold','HorizontalAlignment','center');
text(n2/1.30,-0.18,'AMF','color','k','Fontsize',16,'fontweight','bold','HorizontalAlignment','center');
ylabel('Time (s)','Fontsize',16,'fontweight','bold');
xlabel('Panel','Fontsize',16,'fontweight','bold');
set(gca,'Linewidth',2,'Fontsize',12,'Fontweight','bold');
set(gca,'XTick',0)
colormap(amf_seis);caxis([-0.4,0.4]);
annotation(gcf,'textbox',...
    [0.211 0.627085377821388 0.0201111111111111 0.0196270853778193],...
    'String',{'1'},...
    'FontWeight','bold',...
    'FontSize',15,...
    'FitBoxToText','off',...
    'EdgeColor','none');
annotation(gcf,'textbox',...
    [0.406555555555556 0.627085377821388 0.0201111111111111 0.0196270853778193],...
    'String','2',...
    'FontWeight','bold',...
    'FontSize',15,...
    'FitBoxToText','off',...
    'EdgeColor','none');
annotation(gcf,'textbox',...
    [0.600999999999999 0.627085377821389 0.020111111111111 0.0196270853778193],...
    'String','3',...
    'FontWeight','bold',...
    'FontSize',15,...
    'FitBoxToText','off',...
    'EdgeColor','none');
annotation(gcf,'textbox',...
    [0.801 0.627085377821387 0.0201111111111112 0.0196270853778193],...
    'String','4',...
    'FontWeight','bold',...
    'FontSize',15,...
    'FitBoxToText','off',...
    'EdgeColor','none');
% annotation(gcf,'line',[0.322222222222223 0.321111111111111],...
%     [0.751717369970556 0.628066732090278],'LineWidth',2);
% annotation(gcf,'line',[0.517777777777778 0.516666666666666],...
%     [0.750736015701661 0.627085377821383],'LineWidth',2);
% annotation(gcf,'line',[0.711111111111111 0.71],...
%     [0.752698724239445 0.629048086359167],'LineWidth',2);
% annotation(gcf,'line',[0.71 0.71],[0.75169872423945 0.628066732090284],...
%     'LineWidth',2);
annotation(gcf,'textarrow',[0.447777777777777 0.416961805555555],...
    [0.528734272437178 0.50401804983467],'Color',[1 0 0],'TextColor',[1 0 0],...
    'LineWidth',3,...
    'HeadWidth',25,...
    'HeadLength',15,...
    'FontWeight','bold');
annotation(gcf,'rectangle',...
    [0.12965811965812 0.713545562639478 0.774684210526315 0.0160906422577708],...
    'LineWidth',3);

% zoomed sections
inds1=125:250;
% figure('units','normalized','Position',[0.0 0.0 0.5, 1],'color','w');
ax(3)=subplot(5,1,3);amf_imagesc(d1_11(inds1,:),25,2,x,t(inds1));colormap(ax(2),amf_seis);
ylabel('Time (s)','Fontsize',16,'fontweight','bold');
xlabel('Panel','Fontsize',16,'fontweight','bold');
set(gca,'Linewidth',2,'Fontsize',12,'Fontweight','bold');
set(gca,'XTick',0)
colormap(amf_seis);caxis([-0.4,0.4]);
annotation(gcf,'textbox',...
    [0.191 0.454367026496564 0.0201111111111111 0.0196270853778193],...
    'String',{'1'},...
    'FontWeight','bold',...
    'FontSize',15,...
    'FitBoxToText','off',...
    'EdgeColor','none');
annotation(gcf,'textbox',...
    [0.342111111111111 0.45534838076545 0.0201111111111111 0.0196270853778193],...
    'String','2',...
    'FontWeight','bold',...
    'FontSize',15,...
    'FitBoxToText','off',...
    'EdgeColor','none');
annotation(gcf,'textbox',...
    [0.503222222222222 0.45534838076545 0.0201111111111109 0.0196270853778191],...
    'String','3',...
    'FontWeight','bold',...
    'FontSize',15,...
    'FitBoxToText','off',...
    'EdgeColor','none');
annotation(gcf,'textbox',...
    [0.661 0.454367026496558 0.0201111111111111 0.0196270853778194],...
    'String','4',...
    'FontWeight','bold',...
    'FontSize',15,...
    'FitBoxToText','off',...
    'EdgeColor','none');
annotation(gcf,'textbox',...
    [0.818777777777778 0.45534838076545 0.0201111111111113 0.0196270853778193],...
    'String','5',...
    'FontWeight','bold',...
    'FontSize',15,...
    'FitBoxToText','off',...
    'EdgeColor','none');
% annotation(gcf,'line',[0.283333333333333 0.282222222222222],...
%     [0.579980372914617 0.455348380765456],'LineWidth',2);
% annotation(gcf,'line',[0.438888888888889 0.437777777777778],...
%     [0.57998037291462 0.454367026496565],'LineWidth',2);
% annotation(gcf,'line',[0.594444444444444 0.593333333333333],...
%     [0.579980372914619 0.454367026496565],'LineWidth',2);
% annotation(gcf,'line',[0.748888888888889 0.75],...
%     [0.579980372914619 0.454367026496565],'LineWidth',2);
annotation(gcf,'textarrow',[0.447777777777777 0.416961805555555],...
    [0.528734272437178 0.50401804983467],'Color',[1 0 0],'TextColor',[1 0 0],...
    'LineWidth',3,...
    'HeadWidth',25,...
    'HeadLength',15,...
    'FontWeight','bold');
annotation(gcf,'textarrow',[0.726666666666667 0.705555555555555],...
    [0.50253885633167 0.482305948083465],'Color',[1 0 0],'TextColor',[1 0 0],...
    'LineWidth',3,...
    'HeadWidth',25,...
    'HeadLength',15,...
    'FontWeight','bold',...
    'FontSize',18);

ax(4)=subplot(5,1,4);amf_imagesc(d1_21(inds1,:),25,2,x,t(inds1));colormap(ax(2),amf_seis);
ylabel('Time (s)','Fontsize',16,'fontweight','bold');
xlabel('Panel','Fontsize',12,'fontweight','bold');
set(gca,'Linewidth',2,'Fontsize',12,'Fontweight','bold');
colormap(amf_seis);caxis([-0.4,0.4]);
set(gca,'XTick',0)
annotation(gcf,'textbox',...
    [0.202222222222222 0.285574092247299 0.02 0.0176643768400379],'String','1',...
    'FontWeight','bold',...
    'FontSize',15,...
    'FitBoxToText','off',...
    'EdgeColor','none');
% annotation(gcf,'line',[0.322222222222222 0.323333333333333],...
%     [0.406280667320903 0.282630029440628],'LineWidth',2);
annotation(gcf,'textbox',...
    [0.405555555555556 0.284592737978406 0.02 0.0176643768400379],'String','2',...
    'FontWeight','bold',...
    'FontSize',15,...
    'FitBoxToText','off',...
    'EdgeColor','none');
% annotation(gcf,'line',[0.517777777777778 0.517777777777778],...
%     [0.406262021589794 0.281648675171737],'LineWidth',2);
annotation(gcf,'textbox',...
    [0.607777777777778 0.284592737978407 0.02 0.0176643768400379],'String','3',...
    'FontWeight','bold',...
    'FontSize',15,...
    'FitBoxToText','off',...
    'EdgeColor','none');
% annotation(gcf,'line',[0.71 0.711111111111111],...
%     [0.405280667320903 0.281648675171737],'LineWidth',2);
annotation(gcf,'textbox',...
    [0.792222222222222 0.285574092247296 0.02 0.0176643768400379],'String','4',...
    'FontWeight','bold',...
    'FontSize',15,...
    'FitBoxToText','off',...
    'EdgeColor','none');

annotation(gcf,'textarrow',[0.28 0.259999999999999],...
    [0.342439243378347 0.310121742985126],'Color',[1 0 0],'TextColor',[1 0 0],...
    'LineWidth',3,...
    'HeadWidth',25,...
    'HeadLength',15,...
    'FontWeight','bold',...
    'FontSize',18);
annotation(gcf,'textarrow',[0.668732638888889 0.651111111111111],...
    [0.34777345384379 0.312215629891165],'Color',[1 0 0],'TextColor',[1 0 0],...
    'String',{'Improved signal energy'},...
    'LineWidth',3,...
    'HeadWidth',25,...
    'HeadLength',15,...
    'FontWeight','bold',...
    'FontSize',18);

text(n1/-40,-0.18,'(c)','color','k','Fontsize',20,'fontweight','bold','HorizontalAlignment','center');
text(n2/9.5,-0.14,'Raw','color','k','Fontsize',16,'fontweight','bold','HorizontalAlignment','center');
text(n2/2.45,-0.14,'BP','color','k','Fontsize',16,'fontweight','bold','HorizontalAlignment','center');
text(n2/1.20,-0.14,'BP+SOSVMF','color','k','Fontsize',16,'fontweight','bold','HorizontalAlignment','center');

text(n1/-40,0.25,'(d)','color','k','Fontsize',20,'fontweight','bold','HorizontalAlignment','center');
text(n2/4.0,0.22,'BP+SOSVMF+Curvelet','color','k','Fontsize',16,'fontweight','bold','HorizontalAlignment','center');
text(n2/1.32,0.22,'AMF','color','k','Fontsize',16,'fontweight','bold','HorizontalAlignment','center');
%
% print(gcf,'-depsc','-r300','fig9.eps');
%% Local similarity
%
% figure('units','normalized','Position',[0.0 0.0 0.5, 1],'color','w');
inds1=125:250;

ax(5)=subplot(5,1,5);amf_imagesc(d1_sim1(inds1,:),25,2,x,t(inds1)); colormap(ax(5),jet);hold on
text(n1/-40,0.225,'(e)','color','k','Fontsize',20,'fontweight','bold','HorizontalAlignment','center');
text(n2/9,0.225,'BP','color','k','Fontsize',16,'fontweight','bold','HorizontalAlignment','center');
text(n2/2.6,0.225,'BP+SOSVMF','color','k','Fontsize',16,'fontweight','bold','HorizontalAlignment','center');
text(n2/1.59,0.225,'BP+SOSVMF+Curvelet','color','k','Fontsize',16,'fontweight','bold','HorizontalAlignment','center');
text(n2/1.15,0.225,'AMF','color','k','Fontsize',16,'fontweight','bold','HorizontalAlignment','center');

c = colorbar;c.Label.String = 'Local similarity';c.Label.FontSize = 16;%c.Label.FontWeight = bold;
caxis([0,0.5]);
ylabel('Time (s)','Fontsize',16,'fontweight','bold');
xlabel('Panel','Fontsize',16,'fontweight','bold');
set(gca,'Linewidth',2,'Fontsize',12,'Fontweight','bold');
set(gca,'XTick',0)

annotation(gcf,'textarrow',[0.193333333333334 0.162222222222222],...
    [0.193359540882562 0.166666666666666],'Color',[1 0 0],'TextColor',[1 0 0],...
    'String',{'Visible signal leakage'},...
    'LineWidth',3,...
    'HeadWidth',25,...
    'HeadLength',15,...
    'FontWeight','bold',...
    'FontSize',20);
annotation(gcf,'textarrow',[0.19 0.173333333333333],...
    [0.140562248995984 0.125382787161833],'Color',[1 0 0],'TextColor',[1 0 0],...
    'LineWidth',3,...
    'HeadWidth',25,...
    'HeadLength',15,...
    'FontWeight','bold',...
    'FontSize',18);
annotation(gcf,'textarrow',[0.236666666666667 0.219999999999999],...
    [0.141566265060241 0.12638680322609],'Color',[1 0 0],'TextColor',[1 0 0],...
    'LineWidth',3,...
    'HeadWidth',25,...
    'HeadLength',15,...
    'FontWeight','bold',...
    'FontSize',18);
annotation(gcf,'textarrow',[0.31 0.293333333333333],...
    [0.177710843373494 0.162531381539343],'Color',[1 0 0],'TextColor',[1 0 0],...
    'LineWidth',3,...
    'HeadWidth',25,...
    'HeadLength',15,...
    'FontWeight','bold',...
    'FontSize',18);
annotation(gcf,'textarrow',[0.341111111111111 0.317777777777777],...
    [0.149598393574297 0.151487204832514],'Color',[1 0 0],'TextColor',[1 0 0],...
    'LineWidth',3,...
    'HeadWidth',25,...
    'HeadLength',15,...
    'FontWeight','bold',...
    'FontSize',18);
annotation(gcf,'textarrow',[0.478888888888889 0.462222222222221],...
    [0.177710843373493 0.162531381539342],'Color',[1 0 0],'TextColor',[1 0 0],...
    'LineWidth',3,...
    'HeadWidth',25,...
    'HeadLength',15,...
    'FontWeight','bold',...
    'FontSize',18);
annotation(gcf,'textarrow',[0.547777777777778 0.548888888888888],...
    [0.180722891566265 0.202692024109623],'Color',[1 0 0],'TextColor',[1 0 0],...
    'LineWidth',3,...
    'HeadWidth',25,...
    'HeadLength',15,...
    'FontWeight','bold',...
    'FontSize',18);
annotation(gcf,'textarrow',[0.581111111111111 0.58111111111111],...
    [0.204819277108433 0.225784393587535],'Color',[1 0 0],'TextColor',[1 0 0],...
    'LineWidth',3,...
    'HeadWidth',25,...
    'HeadLength',15,...
    'FontWeight','bold',...
    'FontSize',18);
annotation(gcf,'textarrow',[0.637777777777778 0.659999999999999],...
    [0.218875502008032 0.207712104430908],'Color',[1 0 0],'TextColor',[1 0 0],...
    'LineWidth',3,...
    'HeadWidth',25,...
    'HeadLength',15,...
    'FontWeight','bold',...
    'FontSize',18);
annotation(gcf,'textarrow',[0.66 0.643333333333333],...
    [0.175702811244979 0.160523349410828],'Color',[1 0 0],'TextColor',[1 0 0],...
    'LineWidth',3,...
    'HeadWidth',25,...
    'HeadLength',15,...
    'FontWeight','bold',...
    'FontSize',18);
annotation(gcf,'textarrow',[0.636666666666667 0.656666666666666],...
    [0.124497991967871 0.144459092382715],'Color',[1 0 0],'TextColor',[1 0 0],...
    'LineWidth',3,...
    'HeadWidth',25,...
    'HeadLength',15,...
    'FontWeight','bold',...
    'FontSize',18);
annotation(gcf,'textarrow',[0.66 0.643333333333333],...
    [0.175702811244979 0.160523349410828],'Color',[1 0 0],'TextColor',[1 0 0],...
    'LineWidth',3,...
    'HeadWidth',25,...
    'HeadLength',15,...
    'FontWeight','bold',...
    'FontSize',18);
annotation(gcf,'textarrow',[0.818888888888889 0.84111111111111],...
    [0.221887550200803 0.210724152623679],'Color',[1 0 0],'TextColor',[1 0 0],...
    'LineWidth',3,...
    'HeadWidth',25,...
    'HeadLength',15,...
    'FontWeight','bold',...
    'FontSize',18);
annotation(gcf,'textbox',...
    [0.204444444444444 0.111874386653579 0.02 0.017664376840038],...
    'Color',[1 1 1],...
    'String','1',...
    'FontWeight','bold',...
    'FontSize',15,...
    'FitBoxToText','off',...
    'EdgeColor','none');
annotation(gcf,'textbox',...
    [0.398888888888889 0.111874386653579 0.02 0.0176643768400382],...
    'Color',[1 1 1],...
    'String','2',...
    'FontWeight','bold',...
    'FontSize',15,...
    'FitBoxToText','off',...
    'EdgeColor','none');
annotation(gcf,'textbox',...
    [0.574444444444444 0.111874386653579 0.02 0.0176643768400379],...
    'Color',[1 1 1],...
    'String','3',...
    'FontWeight','bold',...
    'FontSize',15,...
    'FitBoxToText','off',...
    'EdgeColor','none');
annotation(gcf,'textbox',...
    [0.766666666666666 0.110893032384688 0.02 0.0176643768400378],...
    'Color',[1 1 1],...
    'String','4',...
    'FontWeight','bold',...
    'FontSize',15,...
    'FitBoxToText','off',...
    'EdgeColor','none');
% annotation(gcf,'line',[0.311111111111111 0.312222222222222],...
%     [0.234525024533857 0.108930323846909],'LineWidth',2);
% annotation(gcf,'line',[0.675555555555556 0.676666666666667],...
%     [0.234525024533856 0.108930323846908],'LineWidth',2);
% annotation(gcf,'line',[0.492222222222222 0.493333333333333],...
%     [0.234525024533856 0.108930323846908],'LineWidth',2);
print(gcf,'-depsc','-r300','fig4.eps');
%% Plot figures/second field data

figure('units','normalized','Position',[0.0 0.0 0.5, 1],'color','w');
ax(1)=subplot(5,1,1); imagesc(x,t,d2_1);colormap(ax(1),amf_seis);hold on
text(n1/-50,-0.1,'(a)','color','k','Fontsize',20,'fontweight','bold','HorizontalAlignment','center');
text(n2/9.8,-0.15,'Raw','color','k','Fontsize',16,'fontweight','bold','HorizontalAlignment','center');
text(n2/2.45,-0.15,'BP','color','k','Fontsize',16,'fontweight','bold','HorizontalAlignment','center');
text(n2/1.2,-0.15,'BP+SOSVMF','color','k','Fontsize',16,'fontweight','bold','HorizontalAlignment','center');
annotation(gcf,'textbox',...
    [0.188777777777778 0.800785083415112 0.0201111111111111 0.0196270853778193],...
    'String',{'1'},...
    'FontWeight','bold',...
    'FontSize',15,...
    'FitBoxToText','off',...
    'EdgeColor','none');
annotation(gcf,'textbox',...
    [0.343222222222222 0.80078508341511 0.0201111111111111 0.0196270853778193],...
    'String','2',...
    'FontWeight','bold',...
    'FontSize',15,...
    'FitBoxToText','off',...
    'EdgeColor','none');
annotation(gcf,'textbox',...
    [0.506555555555555 0.80078508341511 0.0201111111111111 0.0196270853778193],...
    'String','3',...
    'FontWeight','bold',...
    'FontSize',15,...
    'FitBoxToText','off',...
    'EdgeColor','none');
annotation(gcf,'textbox',...
    [0.666555555555556 0.800785083415109 0.0201111111111112 0.0196270853778193],...
    'String','4',...
    'FontWeight','bold',...
    'FontSize',15,...
    'FitBoxToText','off',...
    'EdgeColor','none');
annotation(gcf,'textbox',...
    [0.818777777777778 0.800785083415109 0.0201111111111113 0.0196270853778193],...
    'String','5',...
    'FontWeight','bold',...
    'FontSize',15,...
    'FitBoxToText','off',...
    'EdgeColor','none');

annotation(gcf,'rectangle',...
    [0.12965811965812 0.85312881303888 0.774684210526314 0.03319919517103],...
    'LineWidth',3);
annotation(gcf,'textarrow',[0.215555555555556 0.245555555555556],...
    [0.8933601609658 0.910393689944963],'Color',[1 0 0],'TextColor',[1 0 0],...
    'LineWidth',3,...
    'HeadWidth',25,...
    'HeadLength',15,...
    'FontWeight','bold',...
    'FontSize',18,...
    'FontName','Helvetica Neue');
annotation(gcf,'textarrow',[0.372222222222222 0.402222222222223],...
    [0.894366197183105 0.911399726162267],'Color',[1 0 0],'TextColor',[1 0 0],...
    'LineWidth',3,...
    'HeadWidth',25,...
    'HeadLength',15,...
    'FontWeight','bold',...
    'FontSize',18,...
    'FontName','Helvetica Neue');
annotation(gcf,'textarrow',[0.68 0.710000000000001],...
    [0.866197183098595 0.883230712077758],'Color',[1 0 0],'TextColor',[1 0 0],...
    'LineWidth',3,...
    'HeadWidth',25,...
    'HeadLength',15,...
    'FontWeight','bold',...
    'FontSize',18,...
    'FontName','Helvetica Neue');
annotation(gcf,'textarrow',[0.846666666666667 0.876666666666667],...
    [0.860171066560002 0.877204595539165],'Color',[1 0 0],'TextColor',[1 0 0],...
    'LineWidth',3,...
    'HeadWidth',25,...
    'HeadLength',15,...
    'FontWeight','bold',...
    'FontSize',18,...
    'FontName','Helvetica Neue');

colormap(amf_seis);caxis([-0.4,0.4]);
ylabel('Time (s)','Fontsize',16,'fontweight','bold');
xlabel('Panel','Fontsize',16,'fontweight','bold');
set(gca,'Linewidth',2,'Fontsize',12,'Fontweight','bold');
set(gca,'XTick',0)

ax(2)=subplot(5,1,2); imagesc(x,t,d2_2);colormap(ax(2),amf_seis);hold on
text(n1/-50,-0.1,'(b)','color','k','Fontsize',20,'fontweight','bold','HorizontalAlignment','center');
% text(n2/6.0,-0.05,'BP+SOSVMF+FK','color','k','Fontsize',16,'fontweight','bold','HorizontalAlignment','center');
text(n2/4.0,-0.15,'BP+SOSVMF+Curvelet','color','k','Fontsize',16,'fontweight','bold','HorizontalAlignment','center');
text(n2/1.33,-0.15,'AMF','color','k','Fontsize',16,'fontweight','bold','HorizontalAlignment','center');
annotation(gcf,'textbox',...
    [0.211 0.627085377821388 0.0201111111111111 0.0196270853778193],...
    'String',{'1'},...
    'FontWeight','bold',...
    'FontSize',15,...
    'FitBoxToText','off',...
    'EdgeColor','none');
annotation(gcf,'textbox',...
    [0.406555555555556 0.627085377821388 0.0201111111111111 0.0196270853778193],...
    'String','2',...
    'FontWeight','bold',...
    'FontSize',15,...
    'FitBoxToText','off',...
    'EdgeColor','none');
annotation(gcf,'textbox',...
    [0.600999999999999 0.627085377821389 0.020111111111111 0.0196270853778193],...
    'String','3',...
    'FontWeight','bold',...
    'FontSize',15,...
    'FitBoxToText','off',...
    'EdgeColor','none');
annotation(gcf,'textbox',...
    [0.801 0.627085377821387 0.0201111111111112 0.0196270853778193],...
    'String','4',...
    'FontWeight','bold',...
    'FontSize',15,...
    'FitBoxToText','off',...
    'EdgeColor','none');

annotation(gcf,'rectangle',...
    [0.130769230769231 0.680090583662628 0.774684210526314 0.03319919517103],...
    'LineWidth',3);
annotation(gcf,'textarrow',[0.254444444444444 0.281111111111111],...
    [0.694162969786591 0.70817839011385],'Color',[1 0 0],'TextColor',[1 0 0],...
    'LineWidth',3,...
    'HeadWidth',25,...
    'HeadLength',15,...
    'FontWeight','bold',...
    'FontSize',18,...
    'FontName','Helvetica Neue');
annotation(gcf,'textarrow',[0.647777777777777 0.677777777777778],...
    [0.689134808853122 0.706168337832284],'Color',[1 0 0],'TextColor',[1 0 0],...
    'LineWidth',3,...
    'HeadWidth',25,...
    'HeadLength',15,...
    'FontWeight','bold',...
    'FontSize',18,...
    'FontName','Helvetica Neue');
annotation(gcf,'textarrow',[0.841111111111111 0.871111111111112],...
    [0.688128772635818 0.70516230161498],'Color',[1 0 0],'TextColor',[1 0 0],...
    'LineWidth',3,...
    'HeadWidth',25,...
    'HeadLength',15,...
    'FontWeight','bold',...
    'FontSize',18,...
    'FontName','Helvetica Neue');
ylabel('Time (s)','Fontsize',16,'fontweight','bold');
xlabel('Panel','Fontsize',16,'fontweight','bold');
set(gca,'Linewidth',2,'Fontsize',12,'Fontweight','bold');
set(gca,'XTick',0)
colormap(amf_seis);caxis([-0.4,0.4]);

% zoomed sections
inds1=250:500;

% figure('units','normalized','Position',[0.0 0.0 0.5, 1],'color','w');
ax(3)=subplot(5,1,3);amf_imagesc(d2_1(inds1,:),25,2,x,t(inds1));colormap(ax(3),amf_seis);hold on
ylabel('Time (s)','Fontsize',16,'fontweight','bold');
xlabel('Panel','Fontsize',16,'fontweight','bold');
set(gca,'Linewidth',2,'Fontsize',12,'Fontweight','bold');
set(gca,'XTick',0)
colormap(amf_seis);caxis([-0.4,0.4]);
annotation(gcf,'textbox',...
    [0.191 0.454367026496564 0.0201111111111111 0.0196270853778193],...
    'String',{'1'},...
    'FontWeight','bold',...
    'FontSize',15,...
    'FitBoxToText','off',...
    'EdgeColor','none');
annotation(gcf,'textbox',...
    [0.342111111111111 0.45534838076545 0.0201111111111111 0.0196270853778193],...
    'String','2',...
    'FontWeight','bold',...
    'FontSize',15,...
    'FitBoxToText','off',...
    'EdgeColor','none');
annotation(gcf,'textbox',...
    [0.503222222222222 0.45534838076545 0.0201111111111109 0.0196270853778191],...
    'String','3',...
    'FontWeight','bold',...
    'FontSize',15,...
    'FitBoxToText','off',...
    'EdgeColor','none');
annotation(gcf,'textbox',...
    [0.661 0.454367026496558 0.0201111111111111 0.0196270853778194],...
    'String','4',...
    'FontWeight','bold',...
    'FontSize',15,...
    'FitBoxToText','off',...
    'EdgeColor','none');
annotation(gcf,'textbox',...
    [0.818777777777778 0.45534838076545 0.0201111111111113 0.0196270853778193],...
    'String','5',...
    'FontWeight','bold',...
    'FontSize',15,...
    'FitBoxToText','off',...
    'EdgeColor','none');

annotation(gcf,'textarrow',[0.383333333333333 0.408888888888889],...
    [0.551307847082496 0.537154253325245],'Color',[1 0 0],'TextColor',[1 0 0],...
    'LineWidth',3,...
    'HeadWidth',25,...
    'HeadLength',15,...
    'FontWeight','bold',...
    'FontSize',18,...
    'FontName','Helvetica Neue');
annotation(gcf,'textarrow',[0.537777777777778 0.567777777777778],...
    [0.527162977867207 0.54419650684637],'Color',[1 0 0],'TextColor',[1 0 0],...
    'LineWidth',3,...
    'HeadWidth',25,...
    'HeadLength',15,...
    'FontWeight','bold',...
    'FontSize',18,...
    'FontName','Helvetica Neue');
annotation(gcf,'textarrow',[0.7 0.73],...
    [0.526156941649904 0.543190470629066],'Color',[1 0 0],'TextColor',[1 0 0],...
    'LineWidth',3,...
    'HeadWidth',25,...
    'HeadLength',15,...
    'FontWeight','bold',...
    'FontSize',18,...
    'FontName','Helvetica Neue');
annotation(gcf,'textarrow',[0.848888888888889 0.878888888888889],...
    [0.529175050301813 0.546208579280976],'Color',[1 0 0],'TextColor',[1 0 0],...
    'LineWidth',3,...
    'HeadWidth',25,...
    'HeadLength',15,...
    'FontWeight','bold',...
    'FontSize',18,...
    'FontName','Helvetica Neue');

ax(4)=subplot(5,1,4);amf_imagesc(d2_2(inds1,:),25,2,x,t(inds1));colormap(ax(4),amf_seis);hold on
ylabel('Time (s)','Fontsize',12,'fontweight','bold');
xlabel('Panel','Fontsize',12,'fontweight','bold');
set(gca,'Linewidth',2,'Fontsize',12,'Fontweight','bold');
set(gca,'XTick',0)
annotation(gcf,'textbox',...
    [0.206555555555556 0.283611383709518 0.0212222222222222 0.0176643768400386],...
    'String',{'1'},...
    'FontWeight','bold',...
    'FontSize',15,...
    'FitBoxToText','off',...
    'EdgeColor','none');
annotation(gcf,'textbox',...
    [0.406555555555556 0.284592737978409 0.019 0.0166830225711466],...
    'String',{'2'},...
    'FontWeight','bold',...
    'FontSize',15,...
    'FitBoxToText','off',...
    'EdgeColor','none');
annotation(gcf,'textbox',...
    [0.605444444444444 0.283611383709518 0.0223333333333333 0.0176643768400389],...
    'String',{'3'},...
    'FontWeight','bold',...
    'FontSize',15,...
    'FitBoxToText','off',...
    'EdgeColor','none');
annotation(gcf,'textbox',...
    [0.801 0.284592737978409 0.0167777777777778 0.0166830225711473],...
    'String',{'4'},...
    'FontWeight','bold',...
    'FontSize',15,...
    'FitBoxToText','off',...
    'EdgeColor','none');

colormap(amf_seis);caxis([-0.4,0.4]);
annotation(gcf,'textarrow',[0.848888888888889 0.878888888888889],...
    [0.350100603621732 0.367134132600895],'Color',[1 0 0],'TextColor',[1 0 0],...
    'LineWidth',3,...
    'HeadWidth',25,...
    'HeadLength',15,...
    'FontWeight','bold',...
    'FontSize',18,...
    'FontName','Helvetica Neue');
annotation(gcf,'textarrow',[0.273333333333333 0.301111111111111],...
    [0.341046277665997 0.362280968707408],'Color',[1 0 0],'TextColor',[1 0 0],...
    'LineWidth',3,...
    'HeadWidth',25,...
    'HeadLength',15,...
    'FontWeight','bold',...
    'FontSize',18);
annotation(gcf,'textarrow',[0.658888888888889 0.683333333333333],...
    [0.349094567404427 0.367311149793925],'Color',[1 0 0],'TextColor',[1 0 0],...
    'String',{'Improved signal energy'},...
    'LineWidth',3,...
    'HeadWidth',25,...
    'HeadLength',15,...
    'FontWeight','bold',...
    'FontSize',18);
annotation(gcf,'textarrow',[0.848888888888889 0.878888888888889],...
    [0.350100603621732 0.367134132600895],'Color',[1 0 0],'TextColor',[1 0 0],...
    'LineWidth',3,...
    'HeadWidth',25,...
    'HeadLength',15,...
    'FontWeight','bold',...
    'FontSize',18,...
    'FontName','Helvetica Neue');
text(n1/-50,-0.28,'(c)','color','k','Fontsize',20,'fontweight','bold','HorizontalAlignment','center');
text(n2/9.5,-0.28,'Raw','color','k','Fontsize',16,'fontweight','bold','HorizontalAlignment','center');
text(n2/2.45,-0.28,'BP','color','k','Fontsize',16,'fontweight','bold','HorizontalAlignment','center');
text(n2/1.20,-0.28,'BP+SOSVMF','color','k','Fontsize',16,'fontweight','bold','HorizontalAlignment','center');

text(n1/-50,0.45,'(d)','color','k','Fontsize',20,'fontweight','bold','HorizontalAlignment','center');
text(n2/4.0,0.45,'BP+SOSVMF+Curvelet','color','k','Fontsize',16,'fontweight','bold','HorizontalAlignment','center');
text(n2/1.33,0.45,'AMF','color','k','Fontsize',16,'fontweight','bold','HorizontalAlignment','center');
% Local similarity
%% figure('units','normalized','Position',[0.0 0.0 0.5, 1],'color','w');
inds2=250:500;

ax(5)=subplot(5,1,5);amf_imagesc(d_sim2(inds2,:),25,2,x,t(inds2)); colormap(ax(5),jet);
text(n1/-50,0.45,'(e)','color','k','Fontsize',20,'fontweight','bold','HorizontalAlignment','center');
text(n2/9,0.45,'BP','color','k','Fontsize',16,'fontweight','bold','HorizontalAlignment','center');
text(n2/2.6,0.45,'BP+SOSVMF','color','k','Fontsize',16,'fontweight','bold','HorizontalAlignment','center');
text(n2/1.59,0.45,'BP+SOSVMF+Curvelet','color','k','Fontsize',16,'fontweight','bold','HorizontalAlignment','center');
text(n2/1.15,0.45,'AMF','color','k','Fontsize',16,'fontweight','bold','HorizontalAlignment','center');
c = colorbar;c.Label.String = 'Local similarity';c.Label.FontSize = 16;%c.Label.FontWeight = bold;
caxis([0,1]);
ylabel('Time (s)','Fontsize',12,'fontweight','bold');
xlabel('Panel','Fontsize',12,'fontweight','bold');
set(gca,'Linewidth',2,'Fontsize',12,'Fontweight','bold');
set(gca,'XTick',0)
annotation(gcf,'textbox',...
    [0.204444444444444 0.111874386653579 0.02 0.017664376840038],...
    'Color',[1 1 1],...
    'String','1',...
    'FontWeight','bold',...
    'FontSize',15,...
    'FitBoxToText','off',...
    'EdgeColor','none');
annotation(gcf,'textbox',...
    [0.398888888888889 0.111874386653579 0.02 0.0176643768400382],...
    'Color',[1 1 1],...
    'String','2',...
    'FontWeight','bold',...
    'FontSize',15,...
    'FitBoxToText','off',...
    'EdgeColor','none');
annotation(gcf,'textbox',...
    [0.574444444444444 0.111874386653579 0.02 0.0176643768400379],...
    'Color',[1 1 1],...
    'String','3',...
    'FontWeight','bold',...
    'FontSize',15,...
    'FitBoxToText','off',...
    'EdgeColor','none');
annotation(gcf,'textbox',...
    [0.766666666666666 0.110893032384688 0.02 0.0176643768400378],...
    'Color',[1 1 1],...
    'String','4',...
    'FontWeight','bold',...
    'FontSize',15,...
    'FitBoxToText','off',...
    'EdgeColor','none');

annotation(gcf,'textarrow',[0.207777777777777 0.188888888888889],...
    [0.165343466421017 0.184738955823293],'Color',[1 0 0],'TextColor',[1 0 0],...
    'LineWidth',3,...
    'HeadWidth',25,...
    'HeadLength',15,...
    'FontWeight','bold',...
    'FontSize',18);
annotation(gcf,'textarrow',[0.272222222222222 0.276666666666667],...
    [0.146267161200132 0.187751004016064],'Color',[1 0 0],'TextColor',[1 0 0],...
    'String',{'Stronger signal leakage'},...
    'LineWidth',3,...
    'HeadWidth',25,...
    'HeadLength',15,...
    'FontWeight','bold',...
    'FontSize',20);
annotation(gcf,'textarrow',[0.361111111111111 0.362222222222222],...
    [0.159638554216867 0.186746987951807],'Color',[1 0 0],'TextColor',[1 0 0],...
    'LineWidth',3,...
    'HeadWidth',25,...
    'HeadLength',15,...
    'FontWeight','bold',...
    'FontSize',18);
annotation(gcf,'textarrow',[0.398888888888889 0.413333333333333],...
    [0.140562248995984 0.165662650602409],'Color',[1 0 0],'TextColor',[1 0 0],...
    'LineWidth',3,...
    'HeadWidth',25,...
    'HeadLength',15,...
    'FontWeight','bold',...
    'FontSize',18);
annotation(gcf,'textarrow',[0.448888888888889 0.463333333333333],...
    [0.151606425702811 0.176706827309236],'Color',[1 0 0],'TextColor',[1 0 0],...
    'LineWidth',3,...
    'HeadWidth',25,...
    'HeadLength',15,...
    'FontWeight','bold',...
    'FontSize',18);
annotation(gcf,'textarrow',[0.571111111111111 0.585555555555556],...
    [0.141566265060241 0.166666666666666],'Color',[1 0 0],'TextColor',[1 0 0],...
    'LineWidth',3,...
    'HeadWidth',25,...
    'HeadLength',15,...
    'FontWeight','bold',...
    'FontSize',18);
annotation(gcf,'textarrow',[0.627777777777778 0.642222222222222],...
    [0.151606425702811 0.176706827309236],'Color',[1 0 0],'TextColor',[1 0 0],...
    'LineWidth',3,...
    'HeadWidth',25,...
    'HeadLength',15,...
    'FontWeight','bold',...
    'FontSize',18);
annotation(gcf,'textarrow',[0.791111111111111 0.82],...
    [0.189759036144577 0.198795180722891],'Color',[1 0 0],'TextColor',[1 0 0],...
    'String',{'Weaker','signal','leakage'},...
    'LineWidth',3,...
    'HeadWidth',25,...
    'HeadLength',15,...
    'FontWeight','bold',...
    'FontSize',18);
% annotation(gcf,'line',[0.284444444444444 0.285555555555556],...
%     [0.923435721295387 0.804710500490677],'LineWidth',2);
% annotation(gcf,'textbox',...
%     [0.351 0.805691854759565 0.0156666666666666 0.01864573110893],'String','2',...
%     'FontWeight','bold',...
%     'FontSize',15,...
%     'FitBoxToText','off',...
%     'EdgeColor','none');
% annotation(gcf,'line',[0.438888888888889 0.44],...
%     [0.924417075564277 0.805691854759566],'LineWidth',2);

annotation(gcf,'textbox',...
    [0.204444444444444 0.111874386653579 0.02 0.017664376840038],...
    'Color',[1 1 1],...
    'String','1',...
    'FontWeight','bold',...
    'FontSize',15,...
    'FitBoxToText','off',...
    'EdgeColor','none');
annotation(gcf,'textbox',...
    [0.398888888888889 0.111874386653579 0.02 0.0176643768400382],...
    'Color',[1 1 1],...
    'String','2',...
    'FontWeight','bold',...
    'FontSize',15,...
    'FitBoxToText','off',...
    'EdgeColor','none');
annotation(gcf,'textbox',...
    [0.574444444444444 0.111874386653579 0.02 0.0176643768400379],...
    'Color',[1 1 1],...
    'String','3',...
    'FontWeight','bold',...
    'FontSize',15,...
    'FitBoxToText','off',...
    'EdgeColor','none');
annotation(gcf,'textbox',...
    [0.766666666666666 0.110893032384688 0.02 0.0176643768400378],...
    'Color',[1 1 1],...
    'String','4',...
    'FontWeight','bold',...
    'FontSize',15,...
    'FitBoxToText','off',...
    'EdgeColor','none');
print(gcf,'-depsc','-r300','fig5.eps');
